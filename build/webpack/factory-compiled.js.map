{"version":3,"sources":["factory.js"],"names":[],"mappings":"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","file":"factory-compiled.js","sourcesContent":["import path from 'path';\nimport { identity } from 'lodash';\nimport ExtractTextPlugin from 'extract-text-webpack-plugin';\nimport {\n  BannerPlugin,\n  DefinePlugin,\n  HotModuleReplacementPlugin,\n  NoErrorsPlugin,\n  optimize,\n} from 'webpack';\nimport nodeExternals from 'webpack-node-externals';\nimport WriteManifestPlugin from './plugins/WriteManifestPlugin';\n\n\nconst hashType = config => {\n  return config.optimise ? 'chunkhash' : 'hash';\n};\n\nconst stylusLoader = config => {\n  const cssLoaderQuery = 'modules&localIdentName=[path][name]--[local]--[hash:base64:5]';\n  if (config.type === 'server') {\n    return `css/locals?${cssLoaderQuery}!stylus`;\n  }\n  return config.optimise\n    ? ExtractTextPlugin.extract(\n      `css?${cssLoaderQuery}!stylus`\n    )\n    : `style?singleton!css?${cssLoaderQuery}!stylus`;\n};\n\nconst cssLoader = config => {\n  if (config.type === 'server') {\n    return 'css';\n  }\n  return config.optimise\n    ? ExtractTextPlugin.extract(\n      'css'\n    )\n    : 'style?singleton!css';\n};\n\nexport default function webpackFactory(config, appConfig) {\n  return {\n    stats: {\n      children: false,\n    },\n\n    entry: {\n      client: {\n        bundle: [\n          config.hotReload && 'webpack-dev-server/client?/',\n          config.hotReload && 'webpack/hot/only-dev-server',\n          'babel-polyfill',\n          path.resolve(__dirname, '..', '..', 'src', 'client', 'index.js'),\n        ].filter(identity),\n      },\n      server: {\n        server: [\n          'babel-polyfill',\n          path.resolve(__dirname, '..', '..', 'src', 'server', 'index.js'),\n        ],\n      },\n    }[config.type],\n\n    output: {\n      filename: config.type === 'server'\n        ? '[name].js'\n        : `[name]-[${hashType(config)}:6].js`,\n      path: path.resolve(__dirname, '..', '..', 'dist'),\n      publicPath: `http://localhost:${appConfig.port}/dist/`,\n    },\n\n    target: { client: 'web', server: 'node' }[config.type],\n\n    externals: [config.type === 'server' && nodeExternals({\n      whitelist: ['bootstrap/dist/css/bootstrap.css',\n                  'bootstrap/dist/css/bootstrap-theme.css'],\n    })].filter(identity),\n\n    devtool: config.debug || config.type === 'server' ? 'cheap-module-inline-source-map' : 'hidden-source-map',\n\n    debug: true,\n\n    module: {\n      loaders: [\n        {\n          test: /\\.js$/,\n          exclude: /node_modules/,\n          loaders: [config.hotReload && 'react-hot', 'babel'].filter(identity),\n        },\n        {\n          test: /\\.json$/,\n          loader: 'json',\n        },\n        {\n          test: /\\.styl$/,\n          loader: stylusLoader(config),\n        },\n        {\n          test: /\\.css$/,\n          loader: cssLoader(config),\n        },\n        {\n          test: /\\.(?:png|svg|woff2?|eot|ttf)$/,\n          loader: 'url?limit=5120&name=[name]-[hash:6].[ext]',\n        },\n      ],\n    },\n\n    plugins: [\n      new DefinePlugin({\n        __CLIENT__: config.type === 'client',\n        __DEV__: config.debug,\n        __DEVELOPMENT__: config.debug,\n        __SERVER__: config.type === 'server',\n        'process.env': {\n          NODE_ENV: JSON.stringify('production'),\n        },\n      }),\n      new NoErrorsPlugin(),\n      config.hotReload && new HotModuleReplacementPlugin(),\n      config.type === 'client' && config.optimise &&\n      new ExtractTextPlugin('[name]-[contenthash:6].css', {\n        allChunks: true,\n      }),\n      config.type === 'server' && config.debug && new BannerPlugin('require(\"source-map-support\").install();', {\n        raw: true,\n        entryOnly: false,\n      }),\n      config.optimise && new optimize.UglifyJsPlugin({\n        compressor: {\n          warnings: false,\n        },\n      }),\n      config.type === 'client' && new WriteManifestPlugin(config),\n    ].filter(identity),\n\n    resolve: {\n      alias: {\n        root: path.resolve(__dirname, '..', '..', 'src'),\n      },\n      extensions: ['', '.json', '.js'],\n      modulesDirectories: [\n        'src',\n        'node_modules',\n      ],\n    },\n  };\n}\n"]}